# user       www www;  ## Default: nobody
# worker_processes  5;  ## Default: 1
# error_log  logs/error.log;
# pid        logs/nginx.pid;
# worker_rlimit_nofile 8192;

# events {
#   worker_connections  4096;  ## Default: 1024
# }

# http {
#   include    conf/mime.types;
#   include    /etc/nginx/proxy.conf;
#   include    /etc/nginx/fastcgi.conf;
#   index    index.html index.htm index.php;

#   default_type application/octet-stream;
#   log_format   main '$remote_addr - $remote_user [$time_local]  $status '
#     '"$request" $body_bytes_sent "$http_referer" '
#     '"$http_user_agent" "$http_x_forwarded_for"';
#   access_log   logs/access.log  main;
#   sendfile     on;
#   tcp_nopush   on;
#   server_names_hash_bucket_size 128; # this seems to be required for some vhosts

#   server { # admin
#     listen       80;
#     server_name  admin.legalmarketinghouse.com www.admin.legalmarketinghouse.com;
#     access_log   logs/admin.legalmarketinghouse.access.log  main;
#     root         /var/www/html;


#   }


upstream client.localhost {
server http://loclhost:8500;
}

# client
server {
    #ssl_certificate /etc/nginx/certs/demo.pem;
    #ssl_certificate_key /etc/nginx/certs/demo.key;

    # serve static files
    # enable gzip compression
      gzip on;
      gzip_comp_level    5;
      gzip_min_length    256;
      gzip_proxied       any;
      gzip_vary          on;

      gzip_types
      application/atom+xml
      application/javascript
      application/json
      application/ld+json
      application/manifest+json
      application/rss+xml
      application/vnd.geo+json
      application/vnd.ms-fontobject
      application/x-font-ttf
      application/x-web-app-manifest+json
      application/xhtml+xml
      application/xml
      font/opentype
      image/bmp
      image/svg+xml
      image/x-icon
      text/cache-manifest
      text/css
      text/plain
      text/vcard
      text/vnd.rim.location.xloc
      text/vtt
      text/x-component
      text/x-cross-domain-policy;
      # text/html is always compressed by gzip module

      # leverage browser caching
        location ~*  \.(jpg|jpeg|png|gif|ico|css|js|ttf|woff)$ {
          add_header Access-Control-Allow-Origin *;
          expires 365d;
        }
      # caching for images 
      location ~* \.(png)$ {
        expires 10d;
      }
      # ignore htaccess file 
      location ~ /\.ht {
        deny all;
      }

      expires $expires;

    server_name legalmarketinghouse.com;

    location / {
        root /usr/share/nginx/html;
        try_files $uri /index.html;
        proxy_pass http://client.localhost;
        include /etc/nginx/proxy_params;
    }
}

upstream admin.localhost {
    server http://loclhost:8400;
}

# admin
server {
    #ssl_certificate /etc/nginx/certs/demo.pem;
    root /var/www/html;
    index index.php;

    server_name admin.legalmarketinghouse.com;

    location / {
        proxy_pass http://admin.localhost;
        include /etc/nginx/proxy_params;
    }

    if (!-e $request_filename) {
      rewrite ^/(.+)$ /index.php?q=$1 last;
    }

  location ~ \.php$ {
    fastcgi_pass localhost:9000;
    fastcgi_index index.php;
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    include fastcgi_params;
  }
}